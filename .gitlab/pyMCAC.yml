.python_init: &python_init
  - pwd
  - ls -l
  - python -V               # Print out python version for debugging
  - source venv/bin/activate

build-python:
  stage: Build
  script:
    - pwd
    - ls -l
    - python -V               # Print out python version for debugging
    - python -m venv venv
    - source venv/bin/activate
    - pip install -r requirements.txt
    - pip install .
  artifacts:
    paths:
      - venv

mypy:
  stage: Static Analysis
  script:
    - *python_init
    - pip install mypy
    - mypy
  needs: ["build-python"]
  dependencies:
    - build-python

flake8:
  stage: Static Analysis
  script:
    - *python_init
    - pip install flake8
    - flake8
  needs: ["build-python"]
  dependencies:
    - build-python

pylint:
  stage: Static Analysis
  #allow_failure: true
  script:
    - *python_init
    - pip install pylint
    - pylint -d C0301 bild/*.py
  needs: ["build-python"]
  dependencies:
    - build-python

isort:
  stage: Static Analysis
  #allow_failure: true
  script:
    - *python_init
    - pip install isort
    - isort .
  needs: ["build-python"]
  dependencies:
    - build-release
    - build-python

black:
  stage: Static Analysis
  #allow_failure: true
  script:
    - *python_init
    - pip install black
    - black .
  needs: ["build-python"]
  dependencies:
    - build-python

unit_test:
  stage: Test
  script:
    - *python_init
    - pip install pytest
    - export PYTHONPATH="$PYTHONPATH:."
    - python -c "import sys;print(sys.path)"
    - pytest
  needs: ["build-release", "build-python"]
  dependencies:
    - build-release
    - build-python
