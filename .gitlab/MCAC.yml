build-Debug:
  stage: Build MCAC
  script:
    - pwd
    - ls -l
    - mkdir build
    - cd build
    - cmake -DWITH_SBL=OFF -DCMAKE_BUILD_TYPE=Debug -DDEBUG_MCAC=ON -DWITH_PYTHON=OFF .. 
    - make -j
  only:
    changes:
      - .gitlab/MCAC.yml
      - src/**/*
      - include/**/*
      - cmake/**/*
      - CMakeLists.txt
  artifacts:
    paths:
      - bin/Debug/MCAC
      - ext_bin

build-Release:
  stage: Build MCAC
  script:
    - pwd
    - ls -l
    - mkdir build
    - cd build
    - cmake -DWITH_SBL=OFF -DCMAKE_BUILD_TYPE=Release -DDEBUG_MCAC=ON -DWITH_PYTHON=OFF ..
    - make -j
  only:
    changes:
      - .gitlab/MCAC.yml
      - src/**/*
      - include/**/*
      - cmake/**/*
      - CMakeLists.txt
  artifacts:
    paths:
      - bin/Release/MCAC
      - ext_bin

mcac_runs 1/4:
  stage: Run
  script:
    #- bin/Release/MCAC validation/test1.ini
    - mkdir -p validation/validation_data
    - touch Release1
  artifacts:
    paths:
      - validation/validation_data
  only:
    changes:
      - bin/**/*
  needs: ["build-Release"]
  dependencies:
    - build-Release

mcac_runs 2/4:
  stage: Run
  script:
    #- bin/Release/MCAC validation/test2.ini
    - mkdir -p validation/validation_data
    - touch Release2
  artifacts:
    paths:
      - validation/validation_data
  only:
    changes:
      - bin/**/*
  needs: ["build-Release"]
  dependencies:
    - build-Release

mcac_runs 3/4:
  stage: Run
  script:
    #- bin/Debug/MCAC validation/test1.ini
    - mkdir -p validation/validation_data
    - touch Debug1
  artifacts:
    paths:
      - validation/validation_data
  only:
    changes:
      - bin/**/*
  needs: ["build-Debug"]
  dependencies:
    - build-Debug
    
mcac_runs 4/4:
  stage: Run
  script:
    #- bin/Debug/MCAC validation/test2.ini
    - mkdir -p validation/validation_data
    - touch Debug2
  artifacts:
    paths:
      - validation/validation_data
  only:
    changes:
      - bin/**/*
  needs: ["build-Debug"]
  dependencies:
    - build-Debug
    
mcac_tests 1/4:
  stage: Test
  script:
    - echo "validation of MCAC occurs here"
    - ls validation/validation_data
  only:
    changes:
      - validation/validation_data/**/*
      - venv/**/*
  needs: ["mcac_runs 1/4"]
  dependencies:
    - mcac_runs 1/4

mcac_tests 2/4:
  stage: Test
  script:
    - echo "validation of MCAC occurs here"
    - ls validation/validation_data
  only:
    changes:
      - validation/validation_data/**/*
      - venv/**/*
  needs: ["mcac_runs 2/4"]
  dependencies:
    - mcac_runs 2/4

mcac_tests 3/4:
  stage: Test
  script:
    - echo "validation of MCAC occurs here"
    - ls validation/validation_data
  only:
    changes:
      - validation/validation_data/**/*
      - venv/**/*
  needs: ["mcac_runs 3/4"]
  dependencies:
    - mcac_runs 3/4

mcac_tests 4/4:
  stage: Test
  script:
    - echo "validation of MCAC occurs here"
    - ls validation/validation_data
  only:
    changes:
      - validation/validation_data/**/*
      - venv/**/*
  needs: ["mcac_runs 4/4"]
  dependencies:
    - mcac_runs 4/4
