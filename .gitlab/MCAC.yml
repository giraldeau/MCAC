build-Debug:
  stage: Build MCAC
  script:
    - pwd
    - ls -l
    - mkdir build
    - cd build
    - cmake -DWITH_SBL=OFF -DCMAKE_BUILD_TYPE=Debug -DDEBUG_MCAC=ON -DWITH_PYTHON=OFF .. 
    - make -j
  only:
    changes:
      - .gitlab/MCAC.yml
      - src/**/*
      - include/**/*
      - cmake/**/*
      - CMakeLists.txt
  artifacts:
    paths:
      - bin/Debug/MCAC
      - ext_bin

build-Release:
  stage: Build MCAC
  script:
    - pwd
    - ls -l
    - mkdir build
    - cd build
    - cmake -DWITH_SBL=OFF -DCMAKE_BUILD_TYPE=Release -DDEBUG_MCAC=ON -DWITH_PYTHON=OFF ..
    - make -j
  only:
    changes:
      - .gitlab/MCAC.yml
      - src/**/*
      - include/**/*
      - cmake/**/*
      - CMakeLists.txt
  artifacts:
    paths:
      - bin/Release/MCAC
      - ext_bin

mcac_runs:
  stage: Run
  script:
    - bin/${opt}/MCAC ${test_case}.ini
  parallel:
    matrix:
      - test_case: 
          - validation/test1
          - validation/test2
      - opt:
          - Debug
          - Release
  artifacts:
    paths:
      - validation/${test_case}_data
  only:
    changes:
      - bin/**/*
  needs: ["build-${opt}"]
  dependencies:
    - build-${opt}

mcac_tests:
  stage: Test
  script:
    - echo "Testing MCAC occurs here"
  only:
    changes:
      - .gitlab/MCAC.yml
      - .gitlab/pyMCAC.yml
      - src/**/*
      - include/**/*
      - pymcac/**/*
      - cmake/**/*
      - CMakeLists.txt
      - venv/**/*
  needs: ["build-python"]
  dependencies:
    - build-python
